<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Project Diagnosis - Smart Link Finder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .test-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .test-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin-left: 10px;
        }
        .status.success { background: #28a745; color: white; }
        .status.error { background: #dc3545; color: white; }
        .status.warning { background: #ffc107; color: black; }
        .status.info { background: #17a2b8; color: white; }
        .recommendation {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
        }
        .recommendation h4 {
            margin-top: 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Complete Project Diagnosis - Smart Link Finder</h1>
        <p>This tool will diagnose all potential issues in your frontend and backend.</p>
        
        <button onclick="runCompleteDiagnosis()">üöÄ Run Complete Diagnosis</button>
        <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://links-management-tool.onrender.com/api';
        let results = document.getElementById('results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            return `<div class="test-item ${className}">
                <strong>[${timestamp}]</strong> ${message}
            </div>`;
        }

        function addSection(title, content) {
            return `<div class="section">
                <h2>${title}</h2>
                ${content}
            </div>`;
        }

        async function testBackendConnectivity() {
            let content = '';
            
            try {
                // Test health endpoint
                const healthResponse = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    content += log(`‚úÖ Backend Health: ${healthResponse.status} - ${JSON.stringify(healthData)}`, 'success');
                } else {
                    content += log(`‚ùå Backend Health: ${healthResponse.status} - ${await healthResponse.text()}`, 'error');
                }
            } catch (error) {
                content += log(`‚ùå Backend Health Error: ${error.message}`, 'error');
            }

            try {
                // Test login endpoint
                const loginResponse = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'akash_super_admin',
                        password: 'akash123'
                    })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    content += log(`‚úÖ Login Endpoint: ${loginResponse.status} - Token received`, 'success');
                    content += log(`üìù User: ${loginData.username}, Role: ${loginData.role}`, 'info');
                } else {
                    content += log(`‚ùå Login Endpoint: ${loginResponse.status} - ${await loginResponse.text()}`, 'error');
                }
            } catch (error) {
                content += log(`‚ùå Login Error: ${error.message}`, 'error');
            }

            return addSection('üîß Backend Connectivity', content);
        }

        async function testFrontendFiles() {
            let content = '';
            
            const frontendFiles = [
                'admin-side-gsk.html',
                'admin-login-ultimate.html',
                'admin-dashboard-ultimate.html',
                'simple-login.html',
                'index.html'
            ];

            for (const file of frontendFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        content += log(`‚úÖ ${file}: Available (${response.status})`, 'success');
                    } else {
                        content += log(`‚ùå ${file}: Not found (${response.status})`, 'error');
                    }
                } catch (error) {
                    content += log(`‚ùå ${file}: Error - ${error.message}`, 'error');
                }
            }

            return addSection('üìÅ Frontend Files', content);
        }

        function checkJavaScriptIssues() {
            let content = '';
            
            // Check for common JavaScript issues
            const checks = [
                { name: 'Global Error Handler', check: () => window.onerror !== undefined },
                { name: 'Promise Rejection Handler', check: () => window.onunhandledrejection !== undefined },
                { name: 'Console Available', check: () => typeof console !== 'undefined' },
                { name: 'Fetch API Available', check: () => typeof fetch !== 'undefined' },
                { name: 'LocalStorage Available', check: () => typeof Storage !== 'undefined' }
            ];

            checks.forEach(({ name, check }) => {
                try {
                    if (check()) {
                        content += log(`‚úÖ ${name}: Available`, 'success');
                    } else {
                        content += log(`‚ùå ${name}: Not Available`, 'error');
                    }
                } catch (error) {
                    content += log(`‚ùå ${name}: Error - ${error.message}`, 'error');
                }
            });

            return addSection('‚ö° JavaScript Environment', content);
        }

        async function testAPIEndpoints() {
            let content = '';
            
            const endpoints = [
                { path: '/health', method: 'GET', auth: false },
                { path: '/auth/login', method: 'POST', auth: false, body: { username: 'akash_super_admin', password: 'akash123' } },
                { path: '/links', method: 'GET', auth: true },
                { path: '/links/search?q=test', method: 'GET', auth: false }
            ];

            for (const endpoint of endpoints) {
                try {
                    const options = {
                        method: endpoint.method,
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        }
                    };

                    if (endpoint.auth) {
                        // Try to get token first
                        const loginResponse = await fetch(`${API_BASE_URL}/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ username: 'akash_super_admin', password: 'akash123' })
                        });
                        
                        if (loginResponse.ok) {
                            const loginData = await loginResponse.json();
                            options.headers['Authorization'] = `Bearer ${loginData.token}`;
                        }
                    }

                    if (endpoint.body) {
                        options.body = JSON.stringify(endpoint.body);
                    }

                    const response = await fetch(`${API_BASE_URL}${endpoint.path}`, options);
                    
                    if (response.ok) {
                        content += log(`‚úÖ ${endpoint.method} ${endpoint.path}: ${response.status}`, 'success');
                    } else {
                        content += log(`‚ùå ${endpoint.method} ${endpoint.path}: ${response.status}`, 'error');
                    }
                } catch (error) {
                    content += log(`‚ùå ${endpoint.method} ${endpoint.path}: ${error.message}`, 'error');
                }
            }

            return addSection('üîå API Endpoints', content);
        }

        function checkConfiguration() {
            let content = '';
            
            // Check browser configuration
            content += log(`üåê Browser: ${navigator.userAgent}`, 'info');
            content += log(`üåç Language: ${navigator.language}`, 'info');
            content += log(`üì± Platform: ${navigator.platform}`, 'info');
            content += log(`üîí Online: ${navigator.onLine}`, 'info');
            
            // Check current page
            content += log(`üìÑ Current Page: ${window.location.href}`, 'info');
            content += log(`üîó Origin: ${window.location.origin}`, 'info');
            
            // Check localStorage
            try {
                const token = localStorage.getItem('adminToken');
                const user = localStorage.getItem('currentUser');
                content += log(`üíæ Token in localStorage: ${token ? 'Yes' : 'No'}`, token ? 'success' : 'warning');
                content += log(`üë§ User in localStorage: ${user ? 'Yes' : 'No'}`, user ? 'success' : 'warning');
            } catch (error) {
                content += log(`‚ùå localStorage Error: ${error.message}`, 'error');
            }

            return addSection('‚öôÔ∏è Configuration', content);
        }

        function generateRecommendations() {
            let content = '';
            
            content += `
                <div class="recommendation">
                    <h4>üéØ Recommendations</h4>
                    <ul>
                        <li><strong>Use admin-login-ultimate.html</strong> - This has the best error handling</li>
                        <li><strong>Use admin-dashboard-ultimate.html</strong> - Most stable dashboard</li>
                        <li><strong>Check browser extensions</strong> - Disable extensions if seeing errors</li>
                        <li><strong>Clear browser cache</strong> - Remove old cached data</li>
                        <li><strong>Use incognito mode</strong> - Test without extensions</li>
                        <li><strong>Check network connection</strong> - Ensure stable internet</li>
                    </ul>
                </div>
            `;

            return addSection('üí° Recommendations', content);
        }

        async function runCompleteDiagnosis() {
            results.innerHTML = '<div class="section"><h2>üöÄ Running Complete Diagnosis...</h2><p>Please wait...</p></div>';
            
            let diagnosisResults = '';
            
            // Run all tests
            diagnosisResults += await testBackendConnectivity();
            diagnosisResults += await testFrontendFiles();
            diagnosisResults += checkJavaScriptIssues();
            diagnosisResults += await testAPIEndpoints();
            diagnosisResults += checkConfiguration();
            diagnosisResults += generateRecommendations();
            
            results.innerHTML = diagnosisResults;
            
            // Scroll to results
            results.scrollIntoView({ behavior: 'smooth' });
        }

        function clearResults() {
            results.innerHTML = '';
        }

        // Auto-run diagnosis on page load
        window.addEventListener('load', () => {
            setTimeout(runCompleteDiagnosis, 1000);
        });
    </script>
</body>
</html>
